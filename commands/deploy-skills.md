---
description: Deploy custom skills and commands from ~/.claude/ to GitHub
allowed-tools: [Bash, Read, Write, Glob, Grep]
---

# Deploy Custom Skills & Commands to GitHub

Deploy all custom (non-symlinked) skills from `~/.claude/skills/` and all command files from `~/.claude/commands/` to a public GitHub repository called `claude-skills`.

The GitHub repo uses a structured layout: skills go under `skills/`, commands go under `commands/`.

## Important: Temp Clone Approach

Do NOT create a git repo inside `~/.claude/skills/`. Instead, always use a temporary clone directory for git operations. This keeps the local `~/.claude/skills/` directory clean and avoids structure mismatches (local is flat, GitHub has `skills/` subfolder).

## Instructions

Execute the following steps in order. Use Bash for all commands.

### Step 1: Detect OS and find `gh` CLI

1. Detect the OS:
   ```
   uname -s
   ```
   - `MINGW*` or `MSYS*` = Windows (Git Bash)
   - `Darwin` = macOS
   - `Linux` = Linux

2. Find `gh` CLI — try these in order:
   ```
   command -v gh 2>/dev/null
   ```
   - If found, use it directly
   - If NOT found on **Windows**: check `/tmp/gh/bin/gh.exe`. If that also doesn't exist, download the portable version:
     ```
     curl -sL https://github.com/cli/cli/releases/latest/download/gh_<VERSION>_windows_amd64.zip -o /tmp/gh.zip
     unzip -o /tmp/gh.zip -d /tmp/gh
     ```
     Then use `/tmp/gh/bin/gh.exe` as the `gh` command for all subsequent steps.
     To find the latest version, run: `curl -sI https://github.com/cli/cli/releases/latest | grep -i location | grep -oP 'v[\d.]+'` or hardcode a recent version.
   - If NOT found on **macOS**: run `brew install gh` (if `brew` not available, tell the user to install Homebrew and stop)
   - If NOT found on **Linux**: tell the user to install `gh` via their package manager and stop

3. Store the working `gh` path in a variable (e.g., `GH_CMD`) for all subsequent steps.

4. Check authentication: `$GH_CMD auth status`
   - If not authenticated, tell the user the full path to run `gh auth login` (use `cygpath -w` on Windows to show the Windows path) and stop

5. Get the GitHub username: `$GH_CMD api user --jq '.login'`

### Step 2: Setup temp working directory

1. Set a temp directory path:
   - Use `/tmp/claude-skills-deploy` (works on all platforms via Git Bash on Windows)
2. If the temp dir already exists, remove it: `rm -rf /tmp/claude-skills-deploy`
3. Check if the repo exists on GitHub: `$GH_CMD repo view <username>/claude-skills 2>/dev/null`
   - If it exists: clone it:
     ```
     git clone https://github.com/<username>/claude-skills.git /tmp/claude-skills-deploy
     ```
   - If it does NOT exist: create the repo and clone it:
     ```
     $GH_CMD repo create claude-skills --public --description "Custom Claude Code skills and commands" --clone=false
     git init /tmp/claude-skills-deploy
     git -C /tmp/claude-skills-deploy branch -M main
     git -C /tmp/claude-skills-deploy remote add origin https://github.com/<username>/claude-skills.git
     ```

### Step 3: Find custom skills and commands locally

**Skills:** Find all directories in `~/.claude/skills/` that are real directories (NOT symlinks):

```
find ~/.claude/skills -maxdepth 1 -mindepth 1 -type d ! -type l -not -name '.git' -not -name 'commands' -not -name 'skills' -exec basename {} \;
```

Note: Also exclude `skills` directory itself (it may exist as a leftover from old git tracking).

**Commands:** Find all `.md` files in `~/.claude/commands/`:

```
find ~/.claude/commands -maxdepth 1 -name '*.md' -exec basename {} \;
```

If no custom skills AND no commands are found, report "Nothing to deploy" and stop.

### Step 4: Sync files to temp repo

1. Create the target directories in the temp repo:
   ```
   mkdir -p /tmp/claude-skills-deploy/skills
   mkdir -p /tmp/claude-skills-deploy/commands
   ```

2. **Clean old skills from temp repo** (to handle deletions):
   ```
   rm -rf /tmp/claude-skills-deploy/skills/*/
   ```

3. **Copy each skill directory** into the `skills/` subfolder:
   ```
   cp -r ~/.claude/skills/<skill-name> /tmp/claude-skills-deploy/skills/
   ```
   Do this for EACH skill found in Step 3.

4. **Copy command files** into the `commands/` subfolder:
   ```
   cp ~/.claude/commands/*.md /tmp/claude-skills-deploy/commands/
   ```

### Step 5: Generate .gitignore

Write a `.gitignore` file at `/tmp/claude-skills-deploy/.gitignore`:

```
# Auto-generated by /deploy-skills
# Ignore junk files
.DS_Store
Thumbs.db
__pycache__/
*.pyc
.env
*.env
```

Note: Since we use a dedicated temp repo (not mixed with local files), a simple exclusion-based `.gitignore` is sufficient — no whitelist needed.

### Step 6: Stage and commit

1. Stage everything: `git -C /tmp/claude-skills-deploy add -A`
2. Check if there are staged changes: `git -C /tmp/claude-skills-deploy diff --cached --quiet`
   - If no changes, clean up temp dir and report "Everything is already up to date" and stop
3. Commit:
   ```
   git -C /tmp/claude-skills-deploy commit -m "Deploy skills & commands - <YYYY-MM-DD HH:MM:SS>"
   ```

### Step 7: Push to GitHub

1. Check if `origin/main` exists: `git -C /tmp/claude-skills-deploy rev-parse --verify origin/main 2>/dev/null`
   - If it does NOT exist (first push): `git -C /tmp/claude-skills-deploy push -u origin main`
   - If it exists: `git -C /tmp/claude-skills-deploy push origin main`

### Step 8: Clean up and report results

1. Remove the temp directory: `rm -rf /tmp/claude-skills-deploy`
2. Tell the user:
   - Which custom skills were deployed (list them)
   - Which commands were deployed (list them)
   - The GitHub repository URL: `https://github.com/<username>/claude-skills`
   - Whether changes were pushed or everything was already up to date
